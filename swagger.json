{"openapi":"3.0.3","info":{"title":"Hola Rental API","version":"1.0.0","description":"Tài liệu API hệ thống lý phòng trọ"},"servers":[{"url":"http://localhost:4000"}],"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}},"schemas":{"Location":{"type":"object","properties":{"address":{"type":"string","example":"Số 1 Võ Văn Sĩ Diện"},"district":{"type":"string","example":"Thủ Đức"},"city":{"type":"string","example":"Hồ Chí Minh"},"lat":{"type":"number","format":"float","example":21.028511},"lng":{"type":"number","format":"float","example":105.804817}}},"LegalDocument":{"type":"object","properties":{"url":{"type":"string","format":"uri","example":"https://example.com/giayphep.pdf"},"type":{"type":"string","enum":["image","pdf"]},"uploaded_at":{"type":"string","format":"date-time","example":"2024-06-01T10:00:00.000Z"}}},"HousingArea":{"type":"object","properties":{"name":{"type":"string","example":"KTX Anh Ba Ko Xỉn"},"description":{"type":"string","example":"Khu nhà ở sinh viên nghèo nàn và xấu"},"location":{"$ref":"#/components/schemas/Location"},"expected_rooms":{"type":"integer","example":100},"legal_documents":{"type":"array","items":{"$ref":"#/components/schemas/LegalDocument"}}},"required":["name","location","expected_rooms"]},"AddHousingAreaRequest":{"type":"object","properties":{"housingArea":{"$ref":"#/components/schemas/HousingArea"}},"required":["housingArea"]},"ResubmitHousingAreaRequest":{"type":"object","properties":{"resubmit":{"type":"object","properties":{"name":{"type":"string","example":"KTX Anh Ba Ko Xỉn (bản cập nhật)"},"description":{"type":"string","example":"Mô tả đã sửa"},"location":{"$ref":"#/components/schemas/Location"},"expected_rooms":{"type":"integer","example":120},"legal_documents":{"type":"array","items":{"$ref":"#/components/schemas/LegalDocument"}}}}},"required":["resubmit"]},"AddRoomRequest":{"type":"object","properties":{"housing_area_id":{"type":"string","example":"684ae6eb7961524650c34936"},"title":{"type":"string","example":"Phòng cao cấp"},"price":{"type":"number","example":666666},"area":{"type":"number","example":12},"facilities":{"type":"array","items":{"type":"number","example":5}},"type":{"type":"string","enum":["SINGLE","COUPLE"],"example":"SINGLE"},"max_occupancy":{"type":"integer","example":2},"room_want_create":{"type":"integer","example":10}},"required":["housing_area_id","title","price","area","facilities","type","max_occupancy","room_want_create"]},"UpdateRoomRequest":{"type":"object","properties":{"room_number":{"type":"string","example":"R123"}}},"Room":{"type":"object","properties":{"_id":{"type":"string","example":"123456abcdef"},"housing_area_id":{"type":"string","example":"684ae6eb7961524650c34936"},"title":{"type":"string","example":"Phòng cao cấp"},"price":{"type":"number","example":666666},"area":{"type":"number","example":12},"facilities":{"type":"array","items":{"type":"integer"},"example":[5,11]},"type":{"type":"string","enum":["SINGLE","COUPLE","FAMILY"],"example":"COUPLE"},"max_occupancy":{"type":"integer","example":2},"created_at":{"type":"string","format":"date-time"}},"required":["housing_area_id","title","price","area","facilities","type","max_occupancy"]},"TransactionType":{"type":"string","enum":["deposit","service","boosting_ads","refund"]},"DepositTransaction":{"type":"object","required":["type","contract_id"],"properties":{"type":{"$ref":"#/components/schemas/TransactionType"},"contract_id":{"type":"string"},"notes":{"type":"string"}}},"ServiceTransaction":{"type":"object","required":["type","zalo_payment"],"properties":{"type":{"$ref":"#/components/schemas/TransactionType"},"zalo_payment":{"type":"object","required":["app_id","app_trans_id","app_time","app_user","amount"],"properties":{"app_id":{"type":"integer"},"app_trans_id":{"type":"string"},"app_time":{"type":"integer"},"app_user":{"type":"string"},"amount":{"type":"number"}}},"notes":{"type":"string"}}},"Transaction":{"type":"object","properties":{"_id":{"type":"string"},"user_id":{"type":"string"},"contract_id":{"type":"string"},"type":{"$ref":"#/components/schemas/TransactionType"},"notes":{"type":"string"},"zalo_payment":{"type":"array","items":{"type":"object"}},"refunds":{"type":"array","items":{"type":"object"}},"created_at":{"type":"string","format":"date-time"}}},"Contract":{"type":"object","properties":{"_id":{"type":"string","example":"665f1b2d4f1e2b001c9c1234"},"tenant_id":{"type":"string","example":"665f1a8c4f1e2b001c9c5678"},"owner_id":{"type":"string","example":"665f1a7e4f1e2b001c9c2345"},"room_id":{"type":"string","example":"665f1b004f1e2b001c9c9999"},"start_date":{"type":"string","format":"date-time","example":"2025-06-20T00:00:00.000Z"},"end_date":{"type":"string","format":"date-time","example":"2025-12-20T00:00:00.000Z"},"tenant_signature":{"type":"boolean","example":true},"owner_signature":{"type":"boolean","example":false},"status":{"type":"string","enum":["pending","active","terminated","expired"],"example":"pending"},"created_at":{"type":"string","format":"date-time","example":"2025-06-20T10:00:00.000Z"},"updated_at":{"type":"string","format":"date-time","example":"2025-06-20T10:00:00.000Z"}},"required":["tenant_id","owner_id","room_id","end_date"]},"CreateDisputeRequest":{"type":"object","properties":{"dispute":{"type":"object","required":["contract_id","reason"],"properties":{"contract_id":{"type":"string","example":"64f2364e2b894b42c66c4d51"},"reason":{"type":"string","example":"Người thuê bỏ phòng"},"evidence":{"type":"array","items":{"type":"string","format":"uri","example":"https://example.com/evidence1.jpg"}}}}},"required":["dispute"]},"Dispute":{"type":"object","properties":{"_id":{"type":"string","example":"665f1b2d4f1e2b001c9c1234"},"contract_id":{"type":"string","example":"64f2364e2b894b42c66c4d51"},"status":{"type":"string","enum":["pending","resolved","rejected"],"example":"pending"},"reason":{"type":"string","example":"Người thuê bỏ phòng"},"evidence":{"type":"array","items":{"type":"string","format":"uri","example":"https://example.com/evidence1.jpg"}},"created_by":{"type":"string","example":"665f1a8c4f1e2b001c9c5678"},"created_at":{"type":"string","format":"date-time","example":"2025-07-20T10:00:00.000Z"},"updated_at":{"type":"string","format":"date-time","example":"2025-07-20T10:00:00.000Z"}},"required":["contract_id","reason","status","created_by"]},"DisputeDetail":{"type":"object","properties":{"dispute":{"$ref":"#/components/schemas/Dispute"},"contract":{"$ref":"#/components/schemas/Contract"}},"required":["dispute","contract"]},"DisputeList":{"type":"array","items":{"$ref":"#/components/schemas/Dispute"}},"DisputeSearchList":{"type":"object","properties":{"disputes":{"type":"array","items":{"$ref":"#/components/schemas/Dispute"}},"total":{"type":"integer","example":10}},"required":["disputes","total"]},"User":{"type":"object","properties":{"_id":{"type":"string","example":"665f1a8c4f1e2b001c9c5678"},"email":{"type":"string","example":"user@example.com"},"full_name":{"type":"string","example":"Nguyen Van A"},"phone":{"type":"string","example":"0912345678"},"role":{"type":"string","enum":["tenant","owner","admin"],"example":"tenant"},"created_at":{"type":"string","format":"date-time","example":"2025-07-20T10:00:00.000Z"},"updated_at":{"type":"string","format":"date-time","example":"2025-07-20T10:00:00.000Z"}},"required":["_id","email","full_name","role"]},"SignupResponse":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Đăng ký thành công"},"data":{"$ref":"#/components/schemas/User"}},"required":["success","message","data"]},"ErrorResponse":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Error message"},"errors":{"type":"object","additionalProperties":{"type":"string"},"example":{"field":"Invalid value"}},"code":{"type":"integer","example":400}},"required":["success","message"]},"DisputeWithUser":{"type":"object","properties":{"_id":{"type":"string","example":"665f1b2d4f1e2b001c9c1234"},"contract_id":{"type":"string","example":"64f2364e2b894b42c66c4d51"},"status":{"type":"string","enum":["pending","resolved","rejected"],"example":"pending"},"reason":{"type":"string","example":"Người thuê bỏ phòng"},"evidence":{"type":"array","items":{"type":"string","format":"uri","example":"https://example.com/evidence1.jpg"}},"created_by":{"type":"string","example":"665f1a8c4f1e2b001c9c5678"},"created_at":{"type":"string","format":"date-time","example":"2025-07-20T10:00:00.000Z"},"updated_at":{"type":"string","format":"date-time","example":"2025-07-20T10:00:00.000Z"},"disputer_info":{"type":"object","properties":{"full_name":{"type":"string","example":"Nguyen Van A"},"email":{"type":"string","example":"user@example.com"},"avatar":{"type":"string","format":"uri","example":"https://example.com/avatar.jpg"}}}},"required":["contract_id","reason","status","created_by","disputer_info"]},"HousingAreaRating":{"type":"object","properties":{"_id":{"type":"string"},"user_id":{"type":"string"},"score":{"type":"number"},"comment":{"type":"string"},"status":{"type":"string"},"created_at":{"type":"string","format":"date-time"},"avatar_url":{"type":"string"},"replies":{"type":"array","items":{"$ref":"#/components/schemas/Reply"}}}},"Reply":{"type":"object","properties":{"role":{"type":"string"},"content":{"type":"string"},"created_at":{"type":"string","format":"date-time"},"user_id":{"type":"string"},"avatar_url":{"type":"string"}}}},"responses":{"UnauthorizedError":{"description":"Không có quyền truy cập","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"User ID not found in request"},"code":{"type":"integer","example":401}}}}}},"NotFoundError":{"description":"Không tìm thấy tài nguyên","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Resource not found"},"code":{"type":"integer","example":404}}}}}},"BadRequestError":{"description":"Yêu cầu không hợp lệ","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Invalid request data"},"code":{"type":"integer","example":400}}}}}},"ForbiddenError":{"description":"Không được phép thực hiện hành động này","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"You have reached the post limit of 10 for this month"},"code":{"type":"integer","example":403}}}}}},"PaymentRequiredError":{"description":"Yêu cầu thanh toán để tiếp tục","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"You can only post one housing area for free. Please make a payment to continue"},"code":{"type":"integer","example":402}}}}}}}},"paths":{"/api/auth/signup":{"post":{"summary":"Đăng ký người dùng mới","description":"Tạo tài khoản người dùng mới trong hệ thống sau khi authentication thành công từ Supabase","tags":["Authentication"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["userId"],"properties":{"userId":{"type":"string","example":"07d0f7a1-eff8-4e8b-bc2e-6ebb873d7320","description":"ID của user từ Supabase Auth"}}}}}},"responses":{"200":{"description":"Đăng ký thành công","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"User registered successfully"},"data":{"$ref":"#/components/schemas/UserDetail"}}}}}},"400":{"description":"Dữ liệu đầu vào không hợp lệ"},"401":{"description":"Không có quyền truy cập"},"500":{"description":"Lỗi máy chủ nội bộ"}}}},"/api/chat/message":{"post":{"summary":"Send a message to holaBot (DeepSeek AI)","tags":["Chat"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","description":"User message","example":"I want to find a room near Tan Xa lake"},"userId":{"type":"string","description":"User ID (optional)","example":"user123"}},"required":["message"]}}}},"responses":{"200":{"description":"Response from AI bot","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Chat processed successfully"},"data":{"type":"object","properties":{"response":{"type":"string","example":"I found 3 rooms near Tan Xa lake..."},"timestamp":{"type":"string","format":"date-time"}}}}}}}},"400":{"description":"Invalid request","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Message is required"}}}}}},"500":{"description":"Server error"}}}},"/api/chat/health":{"get":{"summary":"Check the health of the chat service","tags":["Chat"],"responses":{"200":{"description":"Service is healthy","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Chat service is healthy"},"data":{"type":"object","properties":{"status":{"type":"string","example":"OK"},"timestamp":{"type":"string","format":"date-time"}}}}}}}}}}},"/api/contracts/add/{roomId}":{"post":{"summary":"Tenant tạo hợp đồng thuê phòng","description":"Cho phép người thuê tạo hợp đồng thuê phòng với ngày kết thúc.","tags":["Contract"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"roomId","required":true,"description":"ID của phòng muốn thuê","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"end_date":{"type":"string","format":"date-time","example":"2025-12-31T00:00:00.000Z"}},"required":["end_date"]}}}},"responses":{"201":{"description":"Tạo hợp đồng thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Contract"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/contracts/get-by-tenant":{"get":{"summary":"Lấy danh sách hợp đồng theo người thuê","description":"Trả về tất cả các hợp đồng mà người dùng hiện tại là người thuê.","tags":["Contract"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Danh sách hợp đồng của người thuê","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Contract"}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/contracts/get-by-owner":{"get":{"summary":"Lấy danh sách hợp đồng theo chủ phòng","description":"Trả về tất cả các hợp đồng mà người dùng hiện tại là chủ phòng.","tags":["Contract"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Danh sách hợp đồng của chủ phòng","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Contract"}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/contracts/sign-by-landlord/{contractId}":{"patch":{"summary":"Chủ trọ ký hợp đồng","description":"Cho phép chủ trọ ký hợp đồng dựa trên `contractId`. Yêu cầu xác thực token.","tags":["Contract"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"contractId","required":true,"schema":{"type":"string"},"description":"ID của hợp đồng cần ký"}],"responses":{"200":{"description":"Chủ trọ ký hợp đồng thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Contract"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"description":"Lỗi máy chủ nội bộ"}}}},"/api/contracts/update-deposit-status/{contractId}":{"patch":{"summary":"Cập nhật trạng thái đặt cọc","description":"Cập nhật trạng thái đặt cọc của hợp đồng theo contractId.","tags":["Contract"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"contractId","required":true,"schema":{"type":"string"},"description":"ID của hợp đồng cần cập nhật trạng thái đặt cọc"}],"responses":{"200":{"description":"Cập nhật trạng thái đặt cọc thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Contract"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"description":"Lỗi máy chủ nội bộ"}}}},"/api/contracts/get-by-id/{contractId}":{"get":{"summary":"Lấy hợp đồng theo ID","description":"Trả về thông tin chi tiết của hợp đồng theo contractId.","tags":["Contract"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"contractId","required":true,"schema":{"type":"string"},"description":"ID của hợp đồng cần truy vấn"}],"responses":{"200":{"description":"Lấy hợp đồng thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Contract"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"500":{"description":"Lỗi máy chủ nội bộ"}}}},"/api/contracts/request-extension/{contractId}":{"patch":{"summary":"Yêu cầu gia hạn hợp đồng","description":"Người thuê/Chủ trọ gửi yêu cầu gia hạn hợp đồng và cung cấp ngày kết thúc mới.","tags":["Contract"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"contractId","required":true,"schema":{"type":"string"},"description":"ID của hợp đồng cần yêu cầu gia hạn"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["new_end_date"],"properties":{"new_end_date":{"type":"string","format":"date-time","example":"2025-07-31T00:00:00.000Z","description":"Ngày kết thúc mới mà người thuê muốn đề xuất"}}}}}},"responses":{"200":{"description":"Gửi yêu cầu gia hạn thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Contract"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"description":"Lỗi máy chủ nội bộ"}}}},"/api/contracts/confirm-extension/{contractId}":{"patch":{"summary":"Xác nhận gia hạn hợp đồng","description":"Chủ trọ hoặc người thuê gia đồng ý hạn hợp đồng sau khi gửi yêu cầu.","tags":["Contract"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"contractId","required":true,"schema":{"type":"string"},"description":"ID của hợp đồng cần xác nhận gia hạn"}],"responses":{"200":{"description":"Xác nhận gia hạn thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Contract"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"description":"Không tìm thấy hợp đồng","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Contract not found"},"statusCode":{"type":"integer","example":404}}}}}},"500":{"description":"Lỗi máy chủ nội bộ"}}}},"/api/contracts/statistics-by-owner":{"get":{"summary":"Get contract statistics by room for landlord","description":"Returns detailed statistics about contract counts by room and status.","tags":["Contract"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Contract statistics retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"totalContracts":{"type":"number","description":"Total number of contracts"},"contractsByRoom":{"type":"array","items":{"type":"object","properties":{"room_id":{"type":"string"},"room_title":{"type":"string"},"room_number":{"type":"string"},"housing_area_name":{"type":"string"},"contractCount":{"type":"number"},"contracts":{"type":"array","items":{"type":"object"}}}}},"contractsByStatus":{"type":"object","properties":{"pending":{"type":"number"},"active":{"type":"number"},"expired":{"type":"number"},"terminated":{"type":"number"}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/disputes/add":{"post":{"summary":"Tạo khiếu nại (dispute) cho hợp đồng","tags":["Dispute"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateDisputeRequest"}}}},"responses":{"201":{"description":"Tạo khiếu nại thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Dispute"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"}}}},"/api/disputes/detail/{disputeId}":{"get":{"summary":"Lấy chi tiết một khiếu nại","tags":["Dispute"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"disputeId","required":true,"schema":{"type":"string"},"description":"ID của khiếu nại"}],"responses":{"200":{"description":"Lấy chi tiết khiếu nại thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Dispute"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/disputes/get-by-contract/{contractId}":{"get":{"summary":"Lấy danh sách khiếu nại theo hợp đồng","description":"Trả về tất cả các khiếu nại liên quan đến một hợp đồng cụ thể.","tags":["Dispute"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"contractId","required":true,"schema":{"type":"string"},"description":"ID của hợp đồng cần lấy khiếu nại"}],"responses":{"200":{"description":"Danh sách khiếu nại của hợp đồng","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Disputes retrieved successfully"},"data":{"type":"array","items":{"$ref":"#/components/schemas/Dispute"}}}}}}},"400":{"description":"Thiếu hoặc sai contractId","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/disputes/get-list-search":{"get":{"summary":"Admin - Lấy danh sách khiếu nại có phân trang và lọc theo trạng thái","description":"admin xem danh sách khiếu nại với tùy chọn phân trang và lọc theo trạng thái","tags":["Dispute"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"page","schema":{"type":"integer","default":1},"description":"Số trang hiện tại (pagination)"},{"in":"query","name":"limit","schema":{"type":"integer","default":10},"description":"Số bản ghi mỗi trang"},{"in":"query","name":"status","schema":{"type":"string","enum":["pending","resolved","rejected"]},"description":"Trạng thái của khiếu nại"}],"responses":{"200":{"description":"Danh sách khiếu nại được phân trang","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Disputes retrieved successfully"},"data":{"type":"object","properties":{"total":{"type":"number","example":35},"totalPages":{"type":"number","example":4},"page":{"type":"number","example":1},"disputes":{"type":"array","items":{"$ref":"#/components/schemas/DisputeWithUser"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/disputes/admin-handle-decision/{disputeId}":{"patch":{"summary":"Admin xử lý kết quả khiếu nại (người khiếu nại thắng hoặc từ chối khiếu nại)","tags":["Dispute"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"disputeId","required":true,"schema":{"type":"string"},"description":"ID của khiếu nại cần xử lý"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["reason","decision"],"properties":{"reason":{"type":"string","example":"Người thuê cung cấp bằng chứng hợp lệ về lỗi vi phạm từ phía chủ trọ","description":"Lý do admin đưa ra quyết định xử lý"},"decision":{"type":"string","enum":["disputer_wins","rejected"],"example":"disputer_wins","description":"Kết quả xử lý khiếu nại do admin đưa ra"}}}}}},"responses":{"200":{"description":"Khiếu nại đã được xử lý thành công","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Dispute resolved successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/add":{"post":{"summary":"Thêm khu nhà trọ mới","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddHousingAreaRequest"}}}},"responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/approve/{housingAreaId}":{"patch":{"summary":"Duyệt khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ cần duyệt"}],"responses":{"200":{"description":"Duyệt thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/reject/{housingAreaId}":{"patch":{"summary":"Từ chối khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ cần từ chối"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"reason":{"type":"string","example":"Thiếu giấy tờ hợp pháp"}}}}}},"responses":{"200":{"description":"Từ chối thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/resubmit/{housingAreaId}":{"patch":{"summary":"Nộp lại khu nhà trọ sau khi bị từ chối","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ cần nộp lại"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResubmitHousingAreaRequest"}}}},"responses":{"200":{"description":"Nộp lại thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/user-publish/{housingAreaId}":{"patch":{"summary":"Đăng khu nhà trọ (publish)","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ cần duyệt đăng"}],"responses":{"200":{"description":"Đăng khu nhà trọ thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"402":{"$ref":"#/components/responses/PaymentRequiredError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/user-unpublish/{housingAreaId}":{"patch":{"summary":"Gỡ đăng khu nhà trọ (unpublish)","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ cần gỡ đăng"}],"responses":{"200":{"description":"Gỡ đăng khu nhà trọ thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"402":{"$ref":"#/components/responses/PaymentRequiredError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/admin-publish/{housingAreaId}":{"patch":{"summary":"Admin duyệt và public khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"responses":{"200":{"description":"Public thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/admin-unpublish/{housingAreaId}":{"patch":{"summary":"Admin gỡ public khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"responses":{"200":{"description":"Unpublish thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/detail/{housingAreaId}":{"get":{"summary":"Lấy thông tin khu nhà trọ theo ID","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"responses":{"200":{"description":"Lấy thông tin thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/update-pending/{housingAreaId}":{"patch":{"summary":"Gửi bản cập nhật chờ duyệt cho khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"pendingUpdate":{"type":"object","properties":{"name":{"type":"string","example":"Tôi yêu FPT"}}}}}}}},"responses":{"200":{"description":"Cập nhật chờ duyệt thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/approve-update/{housingAreaId}":{"patch":{"summary":"Admin duyệt bản cập nhật của khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"responses":{"200":{"description":"Duyệt bản cập nhật thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/reject-update/{housingAreaId}":{"patch":{"summary":"Admin từ chối bản cập nhật khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"reason":{"type":"string","example":"Thiếu giấy tờ pháp lý"}}}}}},"responses":{"200":{"description":"Từ chối cập nhật thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/delete/{housingAreaId}":{"delete":{"summary":"Xóa khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"responses":{"200":{"description":"Xóa thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/by-user":{"get":{"summary":"Xem danh sách khu nhà trọ do người dùng tạo","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"status","schema":{"type":"string","enum":["pending","approved","rejected","published","unpublished"]},"required":false,"description":"Lọc theo trạng thái khu nhà trọ"}],"responses":{"200":{"description":"Lấy danh sách thành công","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/HousingArea"}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/{housingAreaId}/rate":{"post":{"summary":"Thêm đánh giá cho khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"score":{"type":"number","example":5},"comment":{"type":"string","example":"Nhà đẹp, sạch sẽ"}}}}}},"responses":{"200":{"description":"Thêm đánh giá thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingAreaRating"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/{housingAreaId}/rate/{id}/status":{"patch":{"summary":"Thay đổi trạng thái đánh giá (duyệt hoặc từ chối)","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ"},{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"ID của đánh giá"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"string","enum":["approved","rejected"],"example":"approved"}}}}}},"responses":{"200":{"description":"Thay đổi trạng thái thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingAreaRating"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/{housingAreaId}/ratings":{"get":{"summary":"Lấy danh sách đánh giá của khu nhà trọ","tags":["HousingArea"],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ"},{"in":"query","name":"status","required":false,"schema":{"type":"string"},"description":"Lọc theo trạng thái đánh giá (approved, pending, rejected)"},{"in":"query","name":"page","required":false,"schema":{"type":"integer"},"description":"Trang hiện tại"},{"in":"query","name":"pageSize","required":false,"schema":{"type":"integer"},"description":"Số lượng đánh giá mỗi trang"}],"responses":{"200":{"description":"Lấy danh sách đánh giá thành công","content":{"application/json":{"schema":{"type":"object","properties":{"ratings":{"type":"array","items":{"$ref":"#/components/schemas/HousingAreaRating"}},"page":{"type":"integer"},"total":{"type":"integer"},"totalPages":{"type":"integer"}}}}}},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/update-admin/{housingAreaId}":{"patch":{"summary":"Cập nhật thông tin khu nhà trọ admin","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"pendingUpdate":{"type":"object","properties":{"name":{"type":"string","example":"Tôi yêu FPT"}}}}}}}},"responses":{"200":{"description":"Cập nhật thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/delete-admin/{housingAreaId}":{"delete":{"summary":"Xóa khu nhà trọ admin","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","schema":{"type":"string"},"required":true,"description":"ID của khu nhà trọ"}],"responses":{"200":{"description":"Xóa thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HousingArea"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/{housingAreaId}/ratings/{ratingId}/reply":{"post":{"summary":"Trả lời một đánh giá của khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ"},{"in":"path","name":"ratingId","required":true,"schema":{"type":"string"},"description":"ID của đánh giá"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"role":{"type":"string","example":"user"},"content":{"type":"string","example":"Cảm ơn bạn đã đánh giá!"}}}}}},"responses":{"200":{"description":"Trả lời đánh giá thành công","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/HousingAreaRating"}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/search":{"get":{"summary":"Tìm kiếm danh sách khu nhà trọ","tags":["HousingArea"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"status","schema":{"type":"string"},"required":false,"description":"Trạng thái của khu nhà trọ"},{"in":"query","name":"search","schema":{"type":"string"},"required":false,"description":"Từ khóa tìm kiếm theo tên hoặc mô tả"},{"in":"query","name":"isPendingUpdate","schema":{"type":"boolean"},"required":false,"description":"Lọc các khu nhà trọ đang chờ cập nhật"},{"in":"query","name":"page","schema":{"type":"integer","minimum":1},"required":false,"description":"Số trang (mặc định là 1)"},{"in":"query","name":"pageSize","schema":{"type":"integer","minimum":1},"required":false,"description":"Số lượng phần tử mỗi trang (mặc định là 10)"}],"responses":{"200":{"description":"Lấy danh sách khu nhà trọ thành công","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Housing areas retrieved successfully"},"data":{"type":"object","properties":{"total":{"type":"integer","example":42},"totalPages":{"type":"integer","example":5},"results":{"type":"array","items":{"$ref":"#/components/schemas/HousingArea"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/housing-areas/top-rated-with-rooms":{"get":{"summary":"Lấy top N khu nhà trọ có rating cao nhất kèm danh sách phòng","tags":["HousingArea"],"parameters":[{"in":"query","name":"topN","schema":{"type":"integer"},"description":"Số lượng khu nhà trọ muốn lấy (default 10)"}],"responses":{"200":{"description":"Thành công","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"_id":{"type":"string"},"name":{"type":"string"},"address":{"type":"string"},"avgRating":{"type":"number"},"rooms":{"type":"array","items":{"type":"object","properties":{"_id":{"type":"string"},"title":{"type":"string"},"price":{"type":"number"},"area":{"type":"number"},"images":{"type":"array","items":{"type":"object","properties":{"url":{"type":"string"},"caption":{"type":"string"},"uploaded_at":{"type":"string","format":"date-time"}}}},"type":{"type":"string"},"max_occupancy":{"type":"number"}}}}}}}}}}}}},"/api/rooms/add-many":{"post":{"summary":"Thêm nhiều phòng vào khu nhà trọ","tags":["Room"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"room":{"$ref":"#/components/schemas/AddRoomRequest"}}}}}},"responses":{"201":{"description":"Thêm phòng thành công","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Room"}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/rooms/update/{roomId}":{"patch":{"summary":"Cập nhật thông tin phòng trọ","tags":["Room"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"roomId","required":true,"schema":{"type":"string"},"description":"ID của phòng trọ"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"room":{"$ref":"#/components/schemas/UpdateRoomRequest"}}}}}},"responses":{"200":{"description":"Cập nhật phòng thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Room"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/rooms/{roomId}":{"delete":{"summary":"Xoá phòng trọ","tags":["Room"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"roomId","required":true,"schema":{"type":"string"},"description":"ID của phòng trọ cần xoá"}],"responses":{"200":{"description":"Xoá phòng thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Room"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/rooms/search":{"get":{"summary":"Tìm kiếm danh sách phòng","tags":["Room"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"page","schema":{"type":"integer","default":1},"description":"Số trang muốn lấy"},{"in":"query","name":"limit","schema":{"type":"integer","default":10},"description":"Số lượng phòng trên mỗi trang"},{"in":"query","name":"minPrice","schema":{"type":"number"},"description":"Giá tối thiểu"},{"in":"query","name":"maxPrice","schema":{"type":"number"},"description":"Giá tối đa"},{"in":"query","name":"minArea","schema":{"type":"number"},"description":"Diện tích tối thiểu (m²)"},{"in":"query","name":"maxArea","schema":{"type":"number"},"description":"Diện tích tối đa (m²)"},{"in":"query","name":"type","schema":{"type":"string","enum":["SINGLE","COUPLE"]},"description":"Loại phòng"},{"in":"query","name":"status","schema":{"type":"string","enum":["available","booked","unavailable"]},"description":"Trạng thái phòng"},{"in":"query","name":"maxOccupancy","schema":{"type":"integer"},"description":"Số người tối đa"},{"in":"query","name":"title","schema":{"type":"string"},"description":"Tiêu đề phòng (tìm kiếm mờ)"},{"in":"query","name":"facilities","schema":{"type":"string","example":"1,2,3"},"description":"Danh sách mã tiện nghi (ngăn cách bằng dấu phẩy)"}],"responses":{"200":{"description":"Danh sách phòng được trả về thành công","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","example":200},"message":{"type":"string","example":"Rooms retrieved successfully"},"data":{"type":"array","items":{"$ref":"#/components/schemas/Room"}},"pagination":{"type":"object","properties":{"page":{"type":"integer","example":1},"limit":{"type":"integer","example":10},"total":{"type":"integer","example":100},"totalPages":{"type":"integer","example":10}}}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/rooms/by-housing-area/{housingAreaId}":{"get":{"summary":"Lấy danh sách phòng theo ID khu nhà trọ","tags":["Room"],"parameters":[{"in":"path","name":"housingAreaId","required":true,"schema":{"type":"string"},"description":"ID của khu nhà trọ"}],"responses":{"200":{"description":"Lấy danh sách phòng thành công","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Room"}}}}},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/rooms/detail/{roomId}":{"get":{"summary":"Lấy chi tiết phòng theo roomId","tags":["Room"],"parameters":[{"in":"path","name":"roomId","required":true,"schema":{"type":"string"},"description":"ID của phòng cần lấy"}],"responses":{"200":{"description":"Lấy chi tiết phòng thành công","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Room"}}}},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/rooms/get-boosting-rooms":{"get":{"summary":"Lấy danh sách phòng đang được boosting","description":"Trả về tất cả các phòng đang có trạng thái boosting (quảng cáo đẩy tin).","tags":["Room"],"responses":{"200":{"description":"Danh sách phòng boosting được lấy thành công","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Rooms with boosting retrieved successfully"},"data":{"type":"array","items":{"type":"object","properties":{"_id":{"type":"string","example":"60c72b2f9b1d4c001c8d4f8a"},"room_number":{"type":"string","example":"A101"},"boost_status":{"type":"boolean","example":true},"boost_start_at":{"type":"string","format":"date-time","example":"2025-06-25T00:00:00.000Z"},"boost_end_at":{"type":"string","format":"date-time","example":"2025-06-28T00:00:00.000Z"}}}},"status":{"type":"number","example":200}}}}}},"500":{"description":"Lỗi máy chủ"}}}},"/api/rooms/get-list-saved-rooms":{"get":{"summary":"Lấy danh sách phòng đã lưu","tags":["Room"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Danh sách phòng đã lưu được trả về thành công","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","example":200},"message":{"type":"string","example":"Saved rooms retrieved successfully"},"data":{"type":"array","items":{"$ref":"#/components/schemas/Room"}}}}}}}}}},"/api/rooms/add-saved-room/{roomId}":{"post":{"summary":"Thêm phòng vào danh sách đã lưu","tags":["Room"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"roomId","required":true,"schema":{"type":"string"},"description":"ID của phòng cần lưu"}],"responses":{"200":{"description":"Phòng đã được thêm vào danh sách đã lưu thành công"}}}},"/api/rooms/delete-room-saved/{roomId}":{"delete":{"summary":"Xoá phòng khỏi danh sách đã lưu","tags":["Room"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"roomId","required":true,"schema":{"type":"string"},"description":"ID của phòng cần xoá khỏi danh sách đã lưu"}],"responses":{"200":{"description":"Phòng đã được xoá khỏi danh sách đã lưu thành công"}}}},"/api/admin/statistics/housing-area":{"get":{"summary":"Lấy thống kê housing area theo thời gian","tags":["Statistics"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"period","required":true,"schema":{"type":"string","enum":["month","quarter","year"]},"description":"Loại thống kê"},{"in":"query","name":"year","required":true,"schema":{"type":"integer","example":2024},"description":"Năm thống kê"},{"in":"query","name":"month","schema":{"type":"integer","minimum":1,"maximum":12},"description":"Tháng (bắt buộc khi period=month)"},{"in":"query","name":"quarter","schema":{"type":"integer","minimum":1,"maximum":4},"description":"Quý (bắt buộc khi period=quarter)"}],"responses":{"200":{"description":"Lấy thống kê housing area thành công","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","example":200},"message":{"type":"string","example":"Newly created accommodation statistics for the selected month retrieved successfully."},"data":{"type":"object","properties":{"period":{"type":"string","example":"month"},"year":{"type":"integer","example":2024},"month":{"type":"integer","example":12},"summary":{"type":"object","properties":{"totalCount":{"type":"integer","example":25},"statusBreakdown":{"type":"object","example":{"publish":15,"pending":8,"rejected":2}},"districtBreakdown":{"type":"object","example":{"Thạch Thất":20,"Quốc Oai":5}},"averageExpectedRooms":{"type":"number","example":12.5},"paidCount":{"type":"integer","example":20},"unpaidCount":{"type":"integer","example":5}}}}}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/admin/statistics/housing-area/overview":{"get":{"summary":"Lấy thống kê tổng quan housing area theo năm","tags":["Statistics"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"year","required":true,"schema":{"type":"integer","example":2024},"description":"Năm thống kê"}],"responses":{"200":{"description":"Lấy thống kê tổng quan housing area thành công","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","example":200},"message":{"type":"string","example":"Housing area overview statistics retrieved successfully."},"data":{"type":"object","properties":{"year":{"type":"integer","example":2024},"overview":{"type":"object","properties":{"totalCount":{"type":"integer","example":150},"statusBreakdown":{"type":"object","example":{"publish":120,"pending":20,"rejected":10}}}},"monthlyBreakdown":{"type":"array","items":{"type":"object","properties":{"month":{"type":"integer","example":1},"count":{"type":"integer","example":12}}}},"trends":{"type":"object","properties":{"peakMonth":{"type":"object","properties":{"month":{"type":"integer","example":6},"count":{"type":"integer","example":25}}}}}}}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/admin/statistics/boost-revenue":{"get":{"summary":"Lấy thống kê doanh thu boost theo thời gian","tags":["Statistics"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"period","required":true,"schema":{"type":"string","enum":["month","quarter","year"]},"description":"Loại thống kê"},{"in":"query","name":"year","required":true,"schema":{"type":"integer","example":2024},"description":"Năm thống kê"},{"in":"query","name":"month","schema":{"type":"integer","minimum":1,"maximum":12},"description":"Tháng (bắt buộc khi period=month)"},{"in":"query","name":"quarter","schema":{"type":"integer","minimum":1,"maximum":4},"description":"Quý (bắt buộc khi period=quarter)"}],"responses":{"200":{"description":"Lấy thống kê doanh thu boost thành công","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","example":200},"message":{"type":"string","example":"Boost revenue statistics for the selected month retrieved successfully."},"data":{"type":"object","properties":{"period":{"type":"string","example":"month"},"year":{"type":"integer","example":2024},"summary":{"type":"object","properties":{"totalBoosts":{"type":"integer","example":45},"totalRevenue":{"type":"integer","example":4500000},"averageRevenuePerBoost":{"type":"integer","example":100000},"uniqueRoomsWithBoost":{"type":"integer","example":35}}}}}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/admin/statistics/posting-revenue":{"get":{"summary":"Lấy thống kê doanh thu đăng bài theo thời gian","tags":["Statistics"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"period","required":true,"schema":{"type":"string","enum":["month","quarter","year"]},"description":"Loại thống kê"},{"in":"query","name":"year","required":true,"schema":{"type":"integer","example":2024},"description":"Năm thống kê"},{"in":"query","name":"month","schema":{"type":"integer","minimum":1,"maximum":12},"description":"Tháng (bắt buộc khi period=month)"},{"in":"query","name":"quarter","schema":{"type":"integer","minimum":1,"maximum":4},"description":"Quý (bắt buộc khi period=quarter)"}],"responses":{"200":{"description":"Lấy thống kê doanh thu đăng bài thành công","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","example":200},"message":{"type":"string","example":"Posting revenue statistics for the selected month retrieved successfully."},"data":{"type":"object","properties":{"period":{"type":"string","example":"month"},"year":{"type":"integer","example":2024},"summary":{"type":"object","properties":{"totalPaidPosts":{"type":"integer","example":80},"totalRevenue":{"type":"integer","example":4000000},"averageRevenuePerPost":{"type":"integer","example":50000},"uniqueUsersWithPaidPosts":{"type":"integer","example":65}}}}}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/admin/statistics/posting-revenue/overview":{"get":{"summary":"Lấy thống kê tổng quan doanh thu đăng bài theo năm","tags":["Statistics"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"year","required":true,"schema":{"type":"integer","example":2024},"description":"Năm thống kê"}],"responses":{"200":{"description":"Lấy thống kê tổng quan doanh thu đăng bài thành công","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","example":200},"message":{"type":"string","example":"Posting revenue overview statistics retrieved successfully."},"data":{"type":"object","properties":{"year":{"type":"integer","example":2024},"overview":{"type":"object","properties":{"totalPaidPosts":{"type":"integer","example":800},"totalRevenue":{"type":"integer","example":40000000}}},"trends":{"type":"object","properties":{"peakMonth":{"type":"object","properties":{"month":{"type":"integer","example":6},"totalRevenue":{"type":"integer","example":5000000}}},"peakQuarter":{"type":"object","properties":{"quarter":{"type":"integer","example":2},"totalRevenue":{"type":"integer","example":12000000}}}}}}}}}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/transactions/add":{"post":{"summary":"Thêm giao dịch mới","description":"Thêm một transaction thuộc loại deposit hoặc service","tags":["Transaction"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"transaction":{"oneOf":[{"$ref":"#/components/schemas/DepositTransaction"},{"$ref":"#/components/schemas/ServiceTransaction"}]}}},"example":{"transaction":{"type":"service","zalo_payment":{"app_id":2554,"app_trans_id":"5","app_time":666,"app_user":"user123","amount":1234,"channel":1234},"notes":"Thanh toán dịch vụ nước"}}}}},"responses":{"201":{"description":"Transaction created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Transaction"}}}},"400":{"$ref":"#/components/responses/BadRequestError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"$ref":"#/components/responses/NotFoundError"}}}},"/api/transactions/history":{"get":{"summary":"Lấy danh sách giao dịch của người dùng","tags":["Transaction"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"page","schema":{"type":"integer","default":1},"description":"Số trang muốn lấy (bắt đầu từ 1)"},{"in":"query","name":"limit","schema":{"type":"integer","default":10},"description":"Số lượng giao dịch trên mỗi trang"}],"responses":{"200":{"description":"Lấy danh sách giao dịch thành công","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Get transaction successfully"},"data":{"type":"array","items":{"$ref":"#/components/schemas/Transaction"}},"pagination":{"type":"object","properties":{"total":{"type":"integer","example":20},"page":{"type":"integer","example":1},"totalPages":{"type":"integer","example":2}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"}}}},"/api/users/test":{"get":{"summary":"Test route","tags":["Users"],"responses":{"200":{"description":"Test message","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Hello world"}}}}}}}}},"/api/users":{"post":{"summary":"Add a new user","tags":["Users"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["user"],"properties":{"user":{"type":"object","required":["name","email","phone"],"properties":{"name":{"type":"string"},"email":{"type":"string"},"phone":{"type":"string"}}}}}}}},"responses":{"201":{"description":"User added successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"User added successfully"}}}}}}}},"get":{"summary":"Get all users","tags":["Users"],"responses":{"200":{"description":"List of all users","content":{"application/json":{"schema":{"type":"array","items":{"type":"object"}}}}}}}},"/api/users/profile":{"put":{"summary":"Update user profile","tags":["Users"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["userDetail"],"properties":{"userDetail":{"type":"object"}}}}}},"responses":{"200":{"description":"User detail updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"User detail updated successfully"},"data":{"type":"object"}}}}}},"401":{"description":"User not authenticated"}}}},"/api/users/{id}":{"get":{"summary":"Get user detail by ID","tags":["Users"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"User ID"}],"responses":{"200":{"description":"User detail retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"User detail retrieved successfully"},"data":{"type":"object"}}}}}}}}},"/api/users/search":{"get":{"summary":"Search users","tags":["Users"],"parameters":[{"in":"query","name":"search","schema":{"type":"string"},"description":"Search term"}],"responses":{"200":{"description":"Search results","content":{"application/json":{"schema":{"type":"array","items":{"type":"object"}}}}}}}},"/api/users/{id}/status":{"patch":{"summary":"Change user status","tags":["Users"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"User ID"}],"responses":{"201":{"description":"User status changed successfully","content":{"application/json":{"schema":{"type":"object"}}}}}}},"/api/users/update-chat/{chatId}":{"patch":{"summary":"Cập nhật danh sách người đã chat của người dùng hiện tại","tags":["Chat"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"chatId","required":true,"schema":{"type":"string"},"description":"ID của người dùng muốn lưu vào danh sách đã chat"}],"responses":{"200":{"description":"Cập nhật thành công","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Chat updated successfully"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Không tìm thấy thông tin người dùng","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"User detail not found"},"code":{"type":"integer","example":404}}}}}}}}},"/api/users/{userId}/property-document":{"delete":{"summary":"Remove property_document from user (reject landlord application)","tags":["Users"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"userId","required":true,"schema":{"type":"string"},"description":"User ID"}],"requestBody":{"required":false,"content":{"application/json":{"schema":{"type":"object","properties":{"reason":{"type":"string","description":"Reason for rejection"}}}}}},"responses":{"200":{"description":"Property document removed successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Property document removed successfully"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"User not found"}}}},"/api/zalopay/agreement-bind":{"post":{"summary":"Create ZaloPay agreement bind","tags":["ZaloPay"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["app_trans_id","identifier","max_amount","binding_data"],"properties":{"app_trans_id":{"type":"string"},"identifier":{"type":"string"},"max_amount":{"type":"number"},"binding_data":{"type":"string"}}}}}},"responses":{"201":{"description":"Agreement bind successful"},"400":{"description":"Agreement bind failed"}}}},"/api/zalopay/create-order":{"post":{"summary":"Create ZaloPay order","tags":["ZaloPay"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["app_trans_id","app_user","amount","embed_data","item","description"],"properties":{"app_trans_id":{"type":"string"},"app_user":{"type":"string"},"amount":{"type":"number"},"embed_data":{"type":"string"},"item":{"type":"string"},"description":{"type":"string"}}}}}},"responses":{"201":{"description":"Create order successful"},"400":{"description":"Create order failed"}}}},"/api/zalopay/query-order":{"post":{"summary":"Query ZaloPay order status","tags":["ZaloPay"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["app_trans_id"],"properties":{"app_trans_id":{"type":"string"}}}}}},"responses":{"200":{"description":"Query order successful"},"400":{"description":"Query order failed"}}}},"/api/zalopay/callback":{"post":{"summary":"ZaloPay payment callback","tags":["ZaloPay"],"description":"Webhook endpoint for ZaloPay payment notifications","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"object"}}}}}},"responses":{"200":{"description":"Callback processed","content":{"application/json":{"schema":{"type":"object","properties":{"return_code":{"type":"number"},"return_message":{"type":"string"}}}}}}}}},"/api/zalopay/create-refund":{"post":{"summary":"Create ZaloPay refund","tags":["ZaloPay"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["m_refund_id","zp_trans_id","amount","description"],"properties":{"m_refund_id":{"type":"string"},"zp_trans_id":{"type":"number"},"amount":{"type":"number"},"description":{"type":"string"}}}}}},"responses":{"201":{"description":"Create refund successful"},"400":{"description":"Create refund failed"}}}},"/api/zalopay/query-refund":{"post":{"summary":"Query ZaloPay refund status","tags":["ZaloPay"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["m_refund_id"],"properties":{"m_refund_id":{"type":"string"}}}}}},"responses":{"200":{"description":"Query refund successful"},"400":{"description":"Query refund failed"}}}}},"tags":[]}